---
title: "Análisis comparativo de la relación calidad-precio en vehículos por tipo de
  motorización: eléctrico, híbrido y de combustible en el mercado global 2025"
author: "Angel Pastrano y Valeria Barreto"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: yes              
    toc_float: no      
    theme: cosmo        
    highlight: tango      
    number_sections: yes
    code_folding: hide
---
```{r setup, include=FALSE}
# Chunk de configuración global
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

color_map_fuel <- c("Petrol" = "#FFD700", "Hybrid" = "#1E90FF", "Diesel" = "#A9A9A9", "plug in hyrbrid" = "#00BFFF")

cat('<style type="text/css">')

#  FUENTE WEB 
cat('@import url("[https://fonts.googleapis.com/css2?family=Aldrich&display=swap](https://fonts.googleapis.com/css2?family=Aldrich&display=swap)");') 
cat('@import url("[https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&display=swap](https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&display=swap)");') 

cat('
body {
  font-family: "Roboto Condensed", sans-serif;
  color: #333;
}
h1, h2 {
  font-family: "Aldrich", sans-serif; /* Fuente temática para títulos */
  color: #1a2a3a; /* Azul muy oscuro/negro técnico */
  border-bottom: 2px solid #007bff; /* Línea azul eléctrico */
  padding-bottom: 5px;
  margin-top: 1.5em; 
}
h1 {
  font-size: 2.5em;
  text-align: center;
  border-bottom: 3px solid #ffc107; /* Línea de rendimiento amarilla */
}
/* Estilo de Tablas */
th {
  background-color: #1a2a3a; 
  color: white;
  padding: 8px;
}
tr:nth-child(even) {
  background-color: #f0f0f0;
}
')
cat('</style>')
```

```{r load_data, include=FALSE}
ruta_data_carros<- file.choose()
data_carros <- read.csv("C:\\Users\\elang\\Documents\\Proyecto final\\Cars Datasets 2025.csv")
```

```{r librerias, include=FALSE}
library(dplyr)
library(stringr)
library(ggplot2)
```
# INTRODUCCION


# METODOLOGIA


# ANALISIS POR SEGMENTOS

# TOP 10 MEJORES CARROS CALIDAD/PRECIO
Este es un ranking basado en el índice QPR (puntos de calidad por cada $1,000 USD), para asi encontrar a los vehículos con mayor eficiencia en calidad-precio del mercado.
A través de este estudio, identificamos no solo los vehículos con el mejor balance, sino que ademas aquellos cuyo alto precio no necesariamente se traduce en una superioridad en calidad, guiando tu decisión hacia la mejor desicion de compra.

Ahora bien, ¿cómo vamos a saber qué carro es más rentable que otro?
Los gustos personales y las percepciones de lo “superior” varían enormemente entre compradores. Por eso, para eliminar subjetividades y ofrecer una evaluación justa y comparable, desarrollamos una fórmula basada en datos técnicos que asigna puntos de calidad a cada vehículo.

## Paso 1 crear la Fórmula:  
Puntos de Calidad = Potencia + Velocidad Máxima – (10 × Aceleración 0-100 km/h)

¿Por qué estos tres factores?
Porque representan, de forma sencilla y universal, el rendimiento básico de un auto:

Potencia (cv) y Velocidad Máxima (km/h):
A mayor potencia y velocidad, más capacidad de respuesta y desempeño.

Aceleración (segundos 0-100 km/h):
Un valor bajo en aceleración es mejor (menos tiempo = más rápido).
Por eso multiplicamos la aceleración por 10 y la restamos:

Un auto rápido (ej. 5 segundos) resta solo 50 puntos.

Un auto lento (ej. 12 segundos) resta 120 puntos.

Ejemplo:
Un auto con 150 cv, 200 km/h de velocidad máxima y aceleración de 8 segundos tendría:
Puntos de Calidad = 150 + 200 – (10 × 8) = 270 puntos

## Paso 2: La Relación Calidad-Precio (QPR)

Pero no basta con saber cuánto rinde un auto, ¿Vale la pena pagar su precio?,
para responder esto, convertimos los Puntos de Calidad en rentabilidad real:

Fórmula QPR = (Puntos de Calidad ÷ Precio) × 1000

Esto nos dice:
¿Cuántos puntos de calidad obtienes por cada $1,000 USD que gastas?

Más alto el QPR = Más rendimiento por tu dinero.

Más bajo el QPR = Menos eficiencia en lo que pagas.
```{r TOP_10_QPR}
# Limpieza, Conversión y Cálculo
data_qpr <- data_carros %>%
  mutate(
    Price_Clean = str_replace_all(Cars.Prices, "[$, ]|approx", ""),
    Price_Avg = case_when(
      str_detect(Price_Clean, "-") ~ {
        prices <- str_split(Price_Clean, "-")[[1]]
        mean(as.numeric(prices), na.rm = TRUE)
      },
      TRUE ~ as.numeric(Price_Clean)
    )
  ) %>%
  mutate(
    HP_Clean = as.numeric(str_extract(HorsePower, "^[0-9.]+")),
    Speed_Clean = as.numeric(str_extract(Total.Speed, "^[0-9.]+")),
    Accel_Clean = as.numeric(str_extract(Performance.0...100..KM.H, "^[0-9.]+|\\d"))
  ) %>%
  filter(!is.na(Price_Avg) & !is.na(HP_Clean) & !is.na(Speed_Clean) & !is.na(Accel_Clean) & Price_Avg > 0) %>%
  mutate(
    Quality_Index = HP_Clean + Speed_Clean - (10 * Accel_Clean)
  ) %>%
  mutate(
    QPR = (Quality_Index / Price_Avg) * 1000
  )

#  Clasificación y Top 10
top_10_qpr <- data_qpr %>%
  arrange(desc(QPR)) %>%
  select(Company.Names, Cars.Names, Fuel.Types, Price_Avg, Quality_Index, QPR) %>%
  head(10)

# Renombrar columnas 
names(top_10_qpr) <- c("Fabricante", "Modelo", "Motorización", "Precio Promedio (USD)", "Índice de Calidad", "Relación QPR (Puntos/1k USD)")

# mostramos el Top 10
print(top_10_qpr)
```


```{r TOP_10_QPR_GRAFICO}
# Grafico del top 10

top_10_plot <- top_10_qpr %>%
  arrange(`Relación QPR (Puntos/1k USD)`) %>% 
  mutate(Label = factor(paste(Fabricante, Modelo), 
                        levels = paste(Fabricante, Modelo)))
grafico_qpr <- ggplot(top_10_plot, aes(x = Label, y = `Relación QPR (Puntos/1k USD)`, fill = Motorización)) +
  geom_bar(stat = "identity", color = "black", width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", `Relación QPR (Puntos/1k USD)`)), 
            hjust = -0.1, size = 3.5, fontface = "bold") +
  
  # estética y etiquetas
  labs(title = "Top 10: Análisis Comparativo de QPR",
       subtitle = "Puntos de Calidad por cada $1000 USD (Mercado Global 2025)",
       x = "Vehículo (Fabricante y Modelo)",
       y = "Relación Calidad-Precio (QPR)") +
  
  coord_flip() +
  scale_fill_manual(values = c("Petrol" = "#FFD700", "Hybrid" = "#1E90FF", "Diesel" = "#A9A9A9", "plug in hyrbrid" = "#00BFFF")) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0, size = 16, face = "bold"),
    plot.subtitle = element_text(hjust = 0, size = 12),
    axis.text.y = element_text(size = 10, face = "bold"),
    axis.title.x = element_text(margin = margin(t = 10)),
    legend.position = "bottom"
  )

# el gráfico
print(grafico_qpr)

```

# COMPARATIVA POR MARCAS

```{r COMPARATIVA_MARCAS}
# Agrupamos los datos por Fabricante y calculamos los promedios
brand_qpr_summary <- data_qpr %>%
  group_by(Company.Names) %>%
  summarise(
    Modelos = n(),
    QPR_Promedio = mean(QPR, na.rm = TRUE),
    Precio_Promedio_USD = mean(Price_Avg, na.rm = TRUE)
  ) %>%
  filter(Modelos >= 2) %>%
  arrange(desc(QPR_Promedio)) %>%
  head(10) %>%
  rename(Fabricante = Company.Names)

print(brand_qpr_summary)

brand_plot <- brand_qpr_summary %>%
  arrange(QPR_Promedio) %>%
  mutate(Fabricante = factor(Fabricante, levels = Fabricante))
grafico_marcas <- ggplot(brand_plot, aes(x = Fabricante, y = QPR_Promedio)) +
  geom_bar(stat = "identity", fill = "#1E90FF", color = "black", width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", QPR_Promedio)), 
            hjust = -0.1, size = 4, fontface = "bold") +
  
  labs(title = "Top 10: Relación QRP Promedio por Marca",
       subtitle = "Basado en el QPR promedio de todos sus modelos (solo marcas con >= 2 modelos)",
       x = "Fabricante",
       y = "QPR Promedio (Puntos/1k USD)") +
  
  # Invertir coordenadas para un gráfico de barras horizontal más legible
  coord_flip() +
  
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0, size = 16, face = "bold"),
    plot.subtitle = element_text(hjust = 0, size = 12),
    axis.text.y = element_text(size = 10, face = "bold"),
    axis.title.x = element_text(margin = margin(t = 10))
  )

# Mostrar el gráfico
print(grafico_marcas)
```

# ANALISIS POR COMBUSTIBLE

```{r ANALISIS_POR_COMBUSTIBLE}
fuel_qpr_summary <- data_qpr %>%
  group_by(Fuel.Types) %>%
  summarise(
    Modelos = n(),
    QPR_Promedio = mean(QPR, na.rm = TRUE),
    Precio_Promedio_USD = mean(Price_Avg, na.rm = TRUE)
  ) %>%
  arrange(desc(QPR_Promedio)) %>%
  rename(Motorización = Fuel.Types)

print(fuel_qpr_summary)

# Gráfico de Combustible
color_map_fuel <- c("Petrol" = "#FFD700", "Hybrid" = "#1E90FF", "Diesel" = "#A9A9A9", "plug in hyrbrid" = "#00BFFF")

fuel_plot <- fuel_qpr_summary %>%
  arrange(QPR_Promedio) %>%
  mutate(Motorización = factor(Motorización, levels = Motorización))

grafico_combustible <- ggplot(fuel_plot, aes(x = Motorización, y = QPR_Promedio, fill = Motorización)) +
  geom_bar(stat = "identity", color = "black", width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", QPR_Promedio)),
            hjust = -0.1, size = 4, fontface = "bold") +
  labs(title = "Relación QRP Promedio por Tipo de Combustible",
       subtitle = "El mejor valor promedio entre tecnologías",
       x = "Tipo de Motorización",
       y = "QPR Promedio (Puntos/1k USD)") +
  coord_flip() +
  scale_fill_manual(values = color_map_fuel) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0, size = 16, face = "bold"),
    axis.text.y = element_text(size = 10, face = "bold"),
    legend.position = "none"
  )

print(grafico_combustible)
```

# CONCLUSIONES Y RECOMENDACIONES